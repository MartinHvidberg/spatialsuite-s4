<?xml version="1.0" encoding="UTF-8"?>
<!-- Viser et OIS og SKAT ikoner for matrikler returneret fra geosearch -->

<!-- https://github.com/Septima/spatialsuite-s4/issues/67 -->

<!-- LÃ¦s om s4's API her: -->
<!-- https://github.com/Septima/spatialsuite-s4/wiki/S4-API -->

<tool type="plugin">
    <requires>
    [if: ModuleDefined("s4") ]
    	<include src="[module:s4.dir]/tools/s4-requires.xml" nodes="/tool/requires/*" mustexist="true"/>
	[endif]
   </requires>
    <src/>
    <jssrc><![CDATA[
    [if: ModuleDefined("s4") ]
           
       	window["_s4CustomButtons"] = window["_s4CustomButtons"] || [];
       	var _s4CustomButtons = window["_s4CustomButtons"];

       	var _s4SkatKnapUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gsFDCoJu0ObNAAAAh1JREFUOMuVkz9MU1EUxn+3JYWmSPrHaKk2hoQSYcUNNxNiHEjc2NCFhUFGFicSY8LUwcVFumkwwVFNdBBJMFFCFIlYEQNKAQFJW15fy0s/h1ce1MYYT3Jzc797z3dOzv0+wx8h672w5sB6Bc42OOtQ/QqBqxC+gYleNyffewfZWVF4Bs5a7eYU+GLg7IL9Dg6euHhLH1x4jAm0G49AdlZYL+FwCwJd0HYN42+rq6RKTmyMQSEDPiCV80jQ/iNpJy0VXoh/hNZuSR+Qsn3yWtdOWso/bUgeS09pLD3VgOvbkEuyNy0flc8uGrpc9yh/YGt+eYX55RXyB3Y9SeKuu+8/wCg/JfxRTOiKAVha3dS9h88ByK5vAJBKJgAYGeynpyPuzi3bJ+xZfAD4Ihwlj05MMrOwyMhgP6lkglQywchgPzMLi4xOTLK0uul203wJgCaaYuAPAdDTETdDt++raJUYnZhkc3fP66Q1GKQ9FvU6OAofJgAqeUBmfNjEYxGKVonWYJDWYJCiVSIei5AZHz5OLr+tEfjDUC2iatkbVG93J8VSqW71dnfWa8KehdAARs5PcbgM/tOYwEWvwvr2vr5v/QLg/NkIyTNhc/IbKWTg3HQNKC9IpddS5cv/C+nYC3NS+Y3kbEhyGsVTyckT0EekSk51ZgKQsyp0WDNTC5hm+HHHHZg9+3cz1ZFU86KaB1ku8KmrptQBCN9ssPNvYVEgzgbM7dMAAAAASUVORK5CYII=";
       	var _s4OisKnapUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gsSChoreCb/twAAAOVJREFUOMvtlL0RgkAQRp/GVHAkprRAAVKAKbkJlGBkCZCQm1oAFkALpCZcBRRgss7c3B+MOEZ+EXPHvvt29/bgr63ahTaUao5AAeRAJssjMAC91vVjFVCp5gBUwBlIAufNQAe0WtfPIFBgV6A016epAiBNWxt8Ay4mdG/9UIVg9reolBjXodTsbqZpOws4nYHTu6amwyIG84FFicQ6KecxZyG3dqwJzGJpLuxloabEXCx13AGOS7AIdPQBhw0TN/iAvVwBbwlCKUpM7wDlHnUfuOvMubab0so4rdVNYn70OHzj+XoBaJpxCymdU/EAAAAASUVORK5CYII=";
        
        _s4CustomButtons.push({"buttonText": "Se BBR-oplysninger", "buttonImage": _s4OisKnapUri, "callBack": s4DoBBRKnap, "searcher": "geosearcher", "target": "matrikelnumre"});
        _s4CustomButtons.push({"buttonText": "Se ejendomsvurdering", "buttonImage": _s4SkatKnapUri, "callBack": s4DoVurderingKnap, "searcher": "geosearcher", "target": "matrikelnumre"});

		function s4DoBBRKnap(result){
		    _s4View.blur();
			if (result.data.type == 'matrikelnummer' && result.data.esrejdnr){
			    var komnr = result.data.esrejdnr.substring(0, 3);
			    var ejdnr = result.data.esrejdnr.substring(3);
        	    var url = "http://www.ois.dk/ui/linkpartner/linkpartner.aspx?CBKORT=TRUE&komnr=" + komnr + "&ejdnr=" + ejdnr;
        	    window.open(url, "_s4DoBBRKnap");
			}
		}

		function s4DoVurderingKnap(result){
		    _s4View.blur();
			if (result.data.type == 'matrikelnummer' && result.data.esrejdnr){
			    var komnr = result.data.esrejdnr.substring(0, 3);
			    var ejdnr = result.data.esrejdnr.substring(3);
			    //var url = "http://www.vurdering.skat.dk/Ejendomsvurdering?KMNR=" + komnr + "&sideNavn=vstarte&EJDNR=" + ejdnr + "&POSTNR=&VEJKODE=&VEJNAVN="; 
			    var url = "http://www.vurdering.skat.dk/borger/ejendomsvurdering/Vis.do?KMNR=" + komnr + "&sideNavn=vstarte&EJDNR=" + ejdnr + "&POSTNR=&VEJKODE=&VEJNAVN="; 
        	    window.open(url, "_s4DoVurderingKnap");
			}
		}

	[endif]
    ]]>
    </jssrc>
</tool>
