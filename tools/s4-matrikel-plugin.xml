<?xml version="1.0" encoding="UTF-8"?>
<!-- Viser et OIS og SKAT ikoner for matrikler returneret fra geosearch -->

<!-- https://github.com/Septima/spatialsuite-s4/issues/67 -->

<!-- LÃ¦s om s4's API her: -->
<!-- https://github.com/Septima/spatialsuite-s4/wiki/S4-API -->

<tool type="plugin">
    <requires>
    [if: ModuleDefined("s4") ]
    	<include src="[module:s4.dir]/tools/s4-requires.xml" nodes="/tool/requires/*" mustexist="true"/>
	[endif]
   </requires>
    <src/>
    <jssrc><![CDATA[
    [if: ModuleDefined("s4") ]
           
       	window["_s4CustomButtons"] = window["_s4CustomButtons"] || [];
       	var _s4CustomButtons = window["_s4CustomButtons"];

       	//var _s4SkatKnapUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gsFDCoJu0ObNAAAAh1JREFUOMuVkz9MU1EUxn+3JYWmSPrHaKk2hoQSYcUNNxNiHEjc2NCFhUFGFicSY8LUwcVFumkwwVFNdBBJMFFCFIlYEQNKAQFJW15fy0s/h1ce1MYYT3Jzc797z3dOzv0+wx8h672w5sB6Bc42OOtQ/QqBqxC+gYleNyffewfZWVF4Bs5a7eYU+GLg7IL9Dg6euHhLH1x4jAm0G49AdlZYL+FwCwJd0HYN42+rq6RKTmyMQSEDPiCV80jQ/iNpJy0VXoh/hNZuSR+Qsn3yWtdOWso/bUgeS09pLD3VgOvbkEuyNy0flc8uGrpc9yh/YGt+eYX55RXyB3Y9SeKuu+8/wCg/JfxRTOiKAVha3dS9h88ByK5vAJBKJgAYGeynpyPuzi3bJ+xZfAD4Ihwlj05MMrOwyMhgP6lkglQywchgPzMLi4xOTLK0uul203wJgCaaYuAPAdDTETdDt++raJUYnZhkc3fP66Q1GKQ9FvU6OAofJgAqeUBmfNjEYxGKVonWYJDWYJCiVSIei5AZHz5OLr+tEfjDUC2iatkbVG93J8VSqW71dnfWa8KehdAARs5PcbgM/tOYwEWvwvr2vr5v/QLg/NkIyTNhc/IbKWTg3HQNKC9IpddS5cv/C+nYC3NS+Y3kbEhyGsVTyckT0EekSk51ZgKQsyp0WDNTC5hm+HHHHZg9+3cz1ZFU86KaB1ku8KmrptQBCN9ssPNvYVEgzgbM7dMAAAAASUVORK5CYII=";
       	var _s4SkatKnapUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAABG2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+Gkqr6gAAAYVpQ0NQc1JHQiBJRUM2MTk2Ni0yLjEAACiRdZG5S0NBEIe/REXRBAsDWohECBYSRaME7TQiHoiEGMGrSV4uIcfjvQQRSwtbCwsPbAxiY62d+A8IgqBWWtiKhYKNyHM2ERLEzLK73/52ZnZ3FuxLaS1j1g9AJps3QlMB99LyirvxmRbacdJNV0Qz9fFgcI6a9nmPTc13fSpXbb9/rSUWNzWwNQmPabqRF54Wnt/I64r3hV1aKhITPhf2GnJB4UelR8v8qjhZYrvK6TLCoQlhl7A7WcXRKtZSRkZ4WNiTSRe03/uolzji2cUFpUvvxCTEFAHczDDJBH4GGZXRTx8++mVFjXhfKX6enMRqMupsYrBOkhR5vKIWJHtc5oTocWlp8RBTf/C3tmZiyFc+wTELDS+W9dELjUfwvWNZXyeW9V2EOqnL9V4lPrcHI2+i71Y0zzG0bsPFVUWLnsLlLnQ86REjUpLqpNsTCXg/A+cytN1C82q5br/7FB8gvAVzN3BwCD3i37r2AyLXZ0fQ6FJEAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGklEQVQ4jX3UTUvVURAG8J9eNUXQikwJouzFDCMIyhBaKUVYiygKkiJbROAHCKpFFLSL+gAuchVELaPauJCgRUKLaKe1CaNXSHoFNVuc+XeP91oDF87M/8wzM88z55ZUW038cmtCAxawmMVrK/yqxFr8jnM3DmA3tmJlfJvCfdwJvw7zywEWYGtwBnsj9hFf0BhFDsb91xjGE5Si+yVg0IEbuIuhAK+0NlyIURdxOuJ1lV224DKuo2eZYkuSJBpmAnQgYqUccAg3sS37WIpzexavkwSCzgB8ixX5GOtxC0ezpPo412MUj7EuizXGeSRAR/JxNmIWT8Ofx1wAz0l0bMan6G4Ov+LuWJyHc07aMI334TfiBI7jpSTOAi5iDyZwOwr8wDgG0VIrcdiM78pLeg5X8DNAxjGJq3iB85J4hU0FTmvR4ecALOwhNqEL17ALO4OnvuDznmWseDrfJJVqJGVfSUKsQj82RPwYVkfHE8rCdAXObAG8I/hqDb9Yl0nlBV7MktZmTTVLojyjLMoMtktKPlfmcgCHpCUu4Q0e4UN09wtnY7qxokKx2L2Ssh0ZHf+yYtQtUXxGttg12aVBHMlAiynqI6Ehi3fjXQD2R6yg6i9oKw5jv/R6GlVbOy4pc3oqK7zECtAmSbU+6S+sR+JwVNrBAmga+yo7+xco6bl1ShvQKwnyFQ9wMrtb1dn/QAsrRYHK5KrO/gB3Om46XJj6xQAAAABJRU5ErkJggg==";       	
       	//var _s4OisKnapUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gsSChoreCb/twAAAOVJREFUOMvtlL0RgkAQRp/GVHAkprRAAVKAKbkJlGBkCZCQm1oAFkALpCZcBRRgss7c3B+MOEZ+EXPHvvt29/bgr63ahTaUao5AAeRAJssjMAC91vVjFVCp5gBUwBlIAufNQAe0WtfPIFBgV6A016epAiBNWxt8Ay4mdG/9UIVg9reolBjXodTsbqZpOws4nYHTu6amwyIG84FFicQ6KecxZyG3dqwJzGJpLuxloabEXCx13AGOS7AIdPQBhw0TN/iAvVwBbwlCKUpM7wDlHnUfuOvMubab0so4rdVNYn70OHzj+XoBaJpxCymdU/EAAAAASUVORK5CYII=";
       	var _s4BbrKnapUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAUAAAAFACjOyrRAAABGElEQVQ4y+WTPU7DQBBG30LkxnKxVTqk9UZyYUGTghv4AIgqHWfgAhyAioouFWmgSxeKNJEQLcgSbmwpJ1gJ3LhYUxAhK8R/0CD4qtmZb55mVrvwJ6S1HmmtR128ex1gY2vtylq70lqPfwRUSkXW2iUwBIbW2qVSKvoW0Pf9CTAHvEraA+ab2k7t10x2DlwDg5qeEynlmzHmoQ0olFKXwAUgGjYTQCSl9Iwx99sFAMIwdPI8nwohJvRQWZYz13XP4jguPoFBEHhFUdwBUR9YRQvHcU6TJHn9spZS6gk47Ah6zrLsqJoYdGh6BNab+AA4bjK3AoUQV2mazuDjKZVledPkb/0pffX7gbvucAG8VM7rrfi2pvZf9Q6a00sEQKTUWAAAAABJRU5ErkJggg==";
       	        
        _s4CustomButtons.push({"buttonText": "Se BBR-oplysninger", "buttonImage": _s4BbrKnapUri, "callBack": s4DoBBRKnap, "searcher": "geosearcher", "target": "matrikelnumre"});
        _s4CustomButtons.push({"buttonText": "Se ejendomsvurdering", "buttonImage": _s4SkatKnapUri, "callBack": s4DoVurderingKnap, "searcher": "geosearcher", "target": "matrikelnumre"});

		function s4DoBBRKnap(result){
		    _s4View.blur();
			if (result.data.type == 'matrikelnummer' && result.data.esrejdnr){
			    var komnr = result.data.esrejdnr.substring(0, 3);
			    var ejdnr = result.data.esrejdnr.substring(3);
        	    var url = "http://www.ois.dk/ui/linkpartner/linkpartner.aspx?CBKORT=TRUE&komnr=" + komnr + "&ejdnr=" + ejdnr;
        	    window.open(url, "_s4DoBBRKnap");
			}
		}

		function s4DoVurderingKnap(result){
		    _s4View.blur();
			if (result.data.type == 'matrikelnummer' && result.data.esrejdnr){
			    var komnr = result.data.esrejdnr.substring(0, 3);
			    var ejdnr = result.data.esrejdnr.substring(3);
			    //var url = "http://www.vurdering.skat.dk/Ejendomsvurdering?KMNR=" + komnr + "&sideNavn=vstarte&EJDNR=" + ejdnr + "&POSTNR=&VEJKODE=&VEJNAVN="; 
			    var url = "http://www.vurdering.skat.dk/borger/ejendomsvurdering/Vis.do?KMNR=" + komnr + "&sideNavn=vstarte&EJDNR=" + ejdnr + "&POSTNR=&VEJKODE=&VEJNAVN="; 
        	    window.open(url, "_s4DoVurderingKnap");
			}
		}

	[endif]
    ]]>
    </jssrc>
</tool>
