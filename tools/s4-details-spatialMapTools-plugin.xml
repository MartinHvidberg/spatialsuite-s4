<?xml version="1.0" encoding="UTF-8"?>
<tool type="plugin">
    <requires>
    [if: ModuleDefined("s4") ]
    	<include src="[module:s4.dir]/tools/s4-requires.xml" nodes="/tool/requires/*" mustexist="true"/>
	[endif]
   </requires>
    <jssrc/>
    <src><![CDATA[
    [if: ModuleDefined("s4") ]
    	var s4SpatialMapToolsHelper = {
    	
			workspace_container_exists: function(){
	        	return (typeof workspace_container !== 'undefined' && workspace_container !== null);
	        },    	
    	
    	
			workspace_isOpen: function(){
       		if (this.workspace_container_exists()){
           			var version = this.workspace_getVersion();
           			if (version == 2){
           				return (workspace_container.id !== -1);
           			} else if (version == 3){
           				return (workspace_container.workspaceid !== -1);
           			}
           		}
      				return false;
           	},
			workspace_getVersion: function(){
           		if (this.workspace_container_exists()){
            		if (workspace_container.id !== undefined){
            			return 2;
            		}else if (workspace_container.workspaceid !== undefined){
            			return 3;
            		}
           		}
           		return -1;
           	},
           	workspace_addResult: function (result){
				if (result.geometry){
					var geojson = new OpenLayers.Format.GeoJSON();
				    var olGeom = geojson.read(result.geometry, 'Geometry');
					var wkt = olGeom.toString();
					
	            	//Determine type
	            	var type = wkt.substring(0, wkt.indexOf("(")).toLowerCase().replace("multi", "").replace("linestring", "line").trim();
	            	
	            	//Determine style
	            	var styleSettings;
	               	if (typeof DefaultStyleSettings !== 'undefined'){
						styleSettings = Gui.Draw.Settings.objToKeyValue(DefaultStyleSettings[type]);
	               	}else{
						styleSettings = Gui.Draw.Settings.objToKeyValue(workspace_container._drawToolBox.styleSettings[type]);
	               	}
	            	
					var newFeature = new Gui.Draw.Feature({
						id: Math.floor(Math.random() * (999999998)) + 999999999,
						type: type,
						wkt: wkt,
						styleSettings: styleSettings
					});
					workspace_container._drawToolBox.addFeature(newFeature);
					workspace_container.features.push(newFeature);
					workspace_container.createdHandler(newFeature);

				}
           	}           	    	
    	}
    
		var S4SpatialMapToolsHandler = function(paramEntry, result, deferred, detailsContent){
    		var list = {type: "list", items: []};
    		
    		if (paramEntry.info){
				var infoButtonCaption = cbInfo.getString('s4.infobutton.caption') + " " + result.title;
				var _s4InfoUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAUAAAAFACjOyrRAAAB3ElEQVQ4y63UPWgUQRQH8P+b2fPACOcXgncQsNjbRg9u75LdwzRGUALCYauFWNvYpTSaLlUK09ppk8pOxCZVZiU3inqSvQghgkUqcwQSk2PnWeSKzX0kc+KDKWbmzY/3htkF/nNQ74JXnqxCyGuDkhOY9o9G9N4adP3gMYFenVLEXEur58M2RY9/26KruaIfPrMCBfdfwaiosASsUQuQdwC8Oxq804t6fu2pNcjAwl5W5FtazbS0mtnLijwDC8eTeMISpKUNrWbHOmLc9WuLrl9bHOuI8Q2tZgFaGnoqPfHK4WsmPACQdDJcEMackYn8CiDXTWknMrlhhDjMdOgXAEmMN/En9fCUCmlrM4q2ZeLUUxgA5GTi1DejaBuEn4NODgH53FH5/Lu/pe4a84URQFwpVmuTzsHuMgErqftZcQ52l71qeBOg86OAgOGXUspMrNU0CUyRwFSs1XSz2Twkw38AtEcDgYl956zyyuE9ZOUXEmbdLQf3i37wZF1HDQi6Mwh1TgBBwHUmvMV+AoYAdd+EVwkuxmur824lvMuMR0NBQ2Cbj5mZXniVAHFDzZdKpW/pPZmeXLpayBGobmECoFuX8wXz/bP+0NPV8TjpB9tXKWGrtbb60a6Af4y//rOdIv5OzGsAAAAASUVORK5CYII=";
	    		var infoClickFunction = Septima.bind(function(result){s4DoInfo(result);}, this, result);
	    		
				var infoIcon = jQuery('<img src="' + _s4InfoUri + '" style="width: 20px;"/>');
				infoIcon.click(infoClickFunction);
				infoIcon.css("cursor", "pointer");
				
	  	    	var infoTitle = jQuery('<span>' + infoButtonCaption + '</span>');
	  	    	infoTitle.click(infoClickFunction);
	  	    	infoTitle.css("cursor", "pointer");
	  	    		
	   	    	list.items.push({type: "object", icon: infoIcon, o1: infoTitle});
    		}
    		
    		if (_s4Params.view.printconfig && paramEntry.print){
				var _s4PrintUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAUAAAAFACjOyrRAAABEUlEQVQ4y92RO07DUBBFz4ytLIPOCaUdIbDSsQEvAGroqdgCqehJTUlDxQJQZD6K3RJLILELiuehIeHj5yixKBC3vPPu0cx98NclPnOQpKfrhJ+KfPzTC30PTThbc6EGUH/75NBvy3NX4LcOo3gUa2DRJoDaSVWV07IB7A/TC+Co42KT+Sw/XgKjeBSL1kWH+8YYu8C+1ZpU5bRUABG33Wkvp1cGD18ZIYCpqphtDtT6ftGZqeoS6L+GV4O7ltmewZZv1grEuJ0X+aFvNEjSS4QD79KduluhEKDX48a92c7CrJHHtSrkMxP05OWjjqb6w9QMriVwJ942XHAukM1neSO/6lMyXJC1zFaf7EmM+bd6B6bIR9G+EvlcAAAAAElFTkSuQmCC";
				var printButtonCaption = "Print";
	    		var printClickFunction = Septima.bind(function(result){s4DoPrint(result);}, this, result);
	
	    		var printIcon = jQuery('<img src="' + _s4PrintUri + '" style="width: 20px;"/>');
	    		printIcon.click(printClickFunction);
	    		printIcon.css("cursor", "pointer");
	    		
	  	    	var printTitle = jQuery('<span>' + printButtonCaption + '</span>');
	  	    	printTitle.click(printClickFunction);
	  	    	printTitle.css("cursor", "pointer");
	    		
	   	    	list.items.push({type: "object", icon: printIcon, o1: printTitle});
    		}
   	    	
    		if (s4SpatialMapToolsHelper.workspace_isOpen()){
				var _s4WorkspaceUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB80lEQVR4XqWMO2tUURhF13fmkipoFDSFYrCxiZBgbNTSJn9AnEL9AYJB7U1hlXRmUASFCCJCXgYEMzh5gRJtUhhMK0RRMIqFyGQycx/bc89FBiURwQWbc1h8e5sk/gdrzLDi4HTJQIIkAwTOQXDs7jLjFdvTqFZ9qsr4kl4uTEubt6RPFdXmZr1b3tG9mJ/yrqKG79KYQvo4pJtXjuvEmfMaudonvUZaQTeH+r0r/+H61H/qnOZm7yp+glwGsF3jxuV1Lg1+pvruLKPVQdiLd2+4MLjJ3C/Xlbs1Lvq7R8+bOAf27TEbnR30dERAiUCWQpwS6PDOHGRZkcgVdwi+N3gP0AsMXBu+r+vD95T/d8sOd71oFkYrk4zdeaCx2+MaGZtA0xBPQssnnoLERzP53US4y+M7oRs9bFY53N2khEMScepYPfaB7WZGkibESUqWJGRZi0PxBpGVAEiJyLv2rFrDTKAAR3qOWqsZ04oT0jQJI2mS+jcfihGpDBCYZETORMCseJDMiZIPElkGMmE+knDOwmsQnB8wCoJh/e0ahQr+tz8SXfv2I9pE5hztvlEul0/yF+YXFleR2p3FpWUKkJlhnq9fNnFhuE2WZRw42I0KAAwgamxttdeCNjo791Cv/8AsGCQFt1Wvg4TYmYEibf7l7if3nz3WIn/amwAAAABJRU5ErkJggg==";
				var buttonCaption = cbInfo.getString('s4.add2workspace.caption');
	    		var clickFunction = Septima.bind(function(result){s4SpatialMapToolsHelper.workspace_addResult(result);}, this, result);
	
	    		var icon = jQuery('<img src="' + _s4WorkspaceUri + '" style="width: 20px;"/>');
	    		icon.click(clickFunction);
	    		icon.css("cursor", "pointer");
	    		
	  	    	var title = jQuery('<span>' + buttonCaption + '</span>');
	  	    	title.click(clickFunction);
	  	    	title.css("cursor", "pointer");
	    		
	   	    	list.items.push({type: "object", icon: icon, o1: title});
    		}
    		
    		//Legend.show();
    		
    		deferred.resolve(detailsContent.formatList(list));
  		};
    
		function addS4SpatialMapTools(paramEntry){
		    if (paramEntry.enabled && (paramEntry.info || (_s4Params.view.printconfig && paramEntry.print)) ){
		    	paramEntry.searcher.addDetailHandlerDef({
		    		"buttonText":  cbInfo.getString('s4.details.tools'),
		    		//"buttonImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAARCAYAAAACCvahAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAB3RJTUUH3QgWADsuxxIEJAAAAAd0RVh0QXV0aG9yAKmuzEgAAAAMdEVYdERlc2NyaXB0aW9uABMJISMAAAAKdEVYdENvcHlyaWdodACsD8w6AAAADnRFWHRDcmVhdGlvbiB0aW1lADX3DwkAAAAJdEVYdFNvZnR3YXJlAF1w/zoAAAALdEVYdERpc2NsYWltZXIAt8C0jwAAAAh0RVh0V2FybmluZwDAG+aHAAAAB3RFWHRTb3VyY2UA9f+D6wAAAAh0RVh0Q29tbWVudAD2zJa/AAAABnRFWHRUaXRsZQCo7tInAAABA0lEQVQ4ja2SPaqDUBCFP3/AKp0WIQErmzT2bsDaLlmCXSDrcAdZhetwCaKlYBmIiJc7N4WPpNMQ32mHjzNnzlgiYvhR9q/gZtgFeD6f1HWNMQbLshYBESEIAo7H4wy3bUue5yilVmFjDOfzmdvtNsNaa0TkPVzTNE2ftQ+HA9frFRFZdVZKcTqdALC2VOUCNE1DURRM04TjOIvAOI6kacrlcpnhx+NBVVXv3GuKoujjvNvtiOMYpRS2vVz9OI6EYQj8R+a+7ynLEhFZdVZKEccxSZLMcNd13O93tNZfOWZZ9oEdx8F1XbTWq9fWWuN5HvCXeRgG2rb9+rd932e/32872AuC+IL3DaMGjAAAAABJRU5ErkJggg==",
		    		//"buttonImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAw5JREFUeNqsVF1Ik1EYfvfnXDrEzenc/BtMA2uSOFAG/rBBl5YkCdpVQbsxiCJICquboIuomwih2669qNyc0GDGYCVhCjptIIPhD6Km081tTnveA4rOz7rxwMs533mf93l/zyc7ODig81zKw4Pb7T6h2N/ft2J7JJPJAjh/xE6QPty1Ioi3crk8fBw/NDQkdvkZjux5eXnDRqPxLvZ7nAULn3HnVqvVI4yRMjxByEaIhsVQWVl5uaenh6xWa/Pe3t7rTCbzoqamprm7u5uqqqoswJQzNrdkylwPnBpAnqWlpWQ2m9U0NjaSXq9/wLrq6mqBgS6F7RNjz6wh1iXIe5B9RjQms9ms4QiKi4uZUADgQEhFRYV6enr6jUqlWgTpNajY4fcThCAaaGtra+Wib25uUlNTkzCGIUWj0SyfLRaLor6+noCjgoKC+/n5+YTmUDAYfAq7zlxCBwPq6uqOogkEAjQxMcEdfsLpRSKRwdXV1dsul4scDoeoH+6Y9MqppsCgy+fzefx+vyCDIUf3TalU3oI6Cn0UXb4zMzMzsrKyImo9Pj5Oo6OjY2jadSnCX4lEomt5eVl0emtri9LptJ91CoWCDhsAZ6F4PE6oH62trdH29vYNXP+UGhs9Qn9eVFQkjDUaDRPZdnd3jwB8RpoXWcdOtVotY55BZTxFCMBwe3v7446ODuEdA8wzyKkMHHPaj7vesrIyQprU0tJCTqfzIcry5dTYIKpEaWkpcYfRVaqtrWUwFRYWvlxYWOgHgayhoaHcbrcTCGh+fp51VFJSwsEkpAhfeb1eG+r2A5/ajY0NJ0eAqFlMx4c3FApx97/iGEc2dpRhUGqw/YjCzPXjLk9NTaVBqEomk7S+vi4AOp1O1HZ2djaDqFzcLMb+8+nxbPFcmUwmFX4CIprJyckxOErabLZOHmqDwaDa2dlxABvMfX6SbxnLjJQTHo/nQiwW+4Mor/J9OBxeTKVS5dBl8K3779/mkBDiw3zd/I2FSN7x82IB8Ye5ubkI5rAXGK/Uz0F23n9sOZ3z+ivAACr6eS/9XnARAAAAAElFTkSuQmCC",
		    		//"buttonImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAUAAAAFACjOyrRAAAB6ElEQVQ4y62SsWuTYRDGf/d+TSy4VIqCg1g0Sd1M00KjYskkqIODU5cWwXYRRFf/AHHTOrYFaUfBwUHdU4wp1CSjTaKDk6iUWFC0ad5z+Gj6vfnyJVV607137/Pc3XMHh2zSL58av3BDIAag0Ky+f/fSd/+DcHTi0qja1gcHYLxzmxtvN6Mwphehsnv2ILHIDlOZ7BwwBXZRTOyr2t1FkKkOyryYgXm1zRNg5oF8tVRcChEmxi4fN7JTBRlqNxMtSSCnDavxVL289s0Z2dB8GCDrp28gJ0M+NqDhSC43iDDdrRNFFlCbRm1akQW6bViYTiSuHnEqJdMX02L0BeiZ/bn0Sa20fj+ITWYmHwtyL8D2Sa3crFUKFWfkWqVQEaMzTmXrrYS66YiJ0Zk9MocQQK3teUZdt9OBaT8S49kMmFXnt2nNhhhCMbPqYwPbGsnlBuPbv78DR7ss5alo6xmAindL0LuEL+Cn3T42XK+/+dNOpMaySwi3/3VkvyzL1XJxzhnZEnsA2nC+9aLYdxs+1jdvz9n68vnX8MlTW8APRO94lkcqnAc53cGV9yxX1PAcJA6yXCsX1hwNoyw1MXkNK6/cHej16sb66yhMzzMRBj4eJObme5skM9lZQeO+cLJTKxVX+uh7uPYXd3qsNDG4dJ8AAAAASUVORK5CYII=",
		    		"buttonImage": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABJ0AAASdAHeZh94AAAAB3RJTUUH3wsEEBQCC4i3FQAAAUpJREFUOMvNlKFLREEQh7/xwFcERRBEDIIWqxjNgs1kMBuMnuH6/QNmm15QEFFBLXIIBxaLQTQopxYth+XQYFBYyywMc2/fnXDBheG9/c3Ox775DU9CCPRzDdDnlQSKyKSINEQkS+TnREQ6EiGEjgAEeAYCcA+Mmdyq6q3c2gRwV4tibKk+rvsXYKQnIFAxoE+ganKnqm8bbRhYywUCU8C3AV66fE31N73tIHADnKeAO1pwAjT1fc/kL1wrYiymgO0IADJjzD5wZABf+mwD5WQPgQdg1uwz4Mndpg7MAAvAaKEpwDRQclrdATfz3C0cGwO7TvRs409Ade/WAB6BQwet9jqHJeDdFDbjEAMHDlru1sMh4NUU/AAT7kyjqKceeKczGICPPBf13LGDrqeALWBZD813McxCr1LAFeDMf2YBtKYtWoqa/Ps/9i9UVjseslrp0QAAAABJRU5ErkJggg==",
		    		"handler": Septima.bind(S4SpatialMapToolsHandler, this, paramEntry)
		    	});
		    }
		}
			
		addS4SpatialMapTools(_s4Params.dawasearcher);
		addS4SpatialMapTools(_s4Params.geosearcher);
		addS4SpatialMapTools(_s4Params.cvrsearcher);
		addS4SpatialMapTools(_s4Params.plansearcher);
		addS4SpatialMapTools(_s4Params.indexsearcher);
	
	[endif]
    ]]>
    </src>
</tool>
